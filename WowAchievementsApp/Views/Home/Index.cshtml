@{
    ViewData["Title"] = "Home Page";
    var characters = ViewBag.Characters as List<WowAchievementsApp.Models.Character> ?? new List<WowAchievementsApp.Models.Character>();
    var isAuthenticated = User.Identity?.IsAuthenticated == true;
}

@if (isAuthenticated)
{
    <div class="text-center mb-4">
        <h1 class="display-4">Your WoW Characters</h1>
        <p class="text-muted">Region: <strong>@(ViewBag.Region ?? "Not set")</strong></p>
    </div>

    @if (!string.IsNullOrEmpty(ViewBag.ErrorMessage as string))
    {
        <div class="alert alert-danger text-center">
            <p><strong>Error:</strong> @ViewBag.ErrorMessage</p>
        </div>
    }

    @if (characters.Count > 0)
    {
        <div class="row">
            @foreach (var character in characters)
            {
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">@character.Name</h5>
                            <p class="card-text">
                                <strong>Realm:</strong> @character.Realm.Name<br />
                                <strong>Level:</strong> @character.Level<br />
                                <strong>Class:</strong> @character.PlayableClass.Name<br />
                                <strong>Race:</strong> @character.PlayableRace.Name<br />
                                <strong>Faction:</strong> @character.Faction.Name
                            </p>
                            <a href="@Url.Action("Achievements", "Home", new { realmSlug = character.Realm.Slug, characterName = character.Name })" 
                               class="btn btn-primary">View Achievements</a>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="alert alert-info text-center">
            <p>No characters found. Make sure you have characters on the selected region.</p>
            @if (ViewBag.DebugInfo != null)
            {
                <p class="small text-muted mt-2">Debug: @ViewBag.DebugInfo</p>
            }
        </div>
    }
}
else
{
    <div class="text-center">
        <h1 class="display-4">Welcome</h1>
        <p>Select your region and log in with Battle.net:</p>

        <form asp-controller="Account" asp-action="Login" method="post">
            <div class="form-group mb-3">
                <label for="region">Region:</label>
                <select name="region" id="region" class="form-control" style="max-width: 300px; margin: 0 auto;">
                    <option value="us">Americas</option>
                    <option value="eu">Europe</option>
                    <option value="kr">Korea</option>
                    <option value="tw">Taiwan</option>
                    <option value="cn">China</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary mt-3">Login with Battle.net</button>
        </form>
    </div>
}
